<ng-container *ngIf="isVisible">
  
  <ng-container *ngIf="isReady; else communicating">

    <!-- <mat-stepper linear #stepper> -->
    <mat-stepper linear #stepper>
      <mat-step [editable]="false" label="Choose a WiFi network">
        <ng-template matStepContent>
          <app-wifi-credentials></app-wifi-credentials>
        </ng-template>
      </mat-step>
      <mat-step [editable]="false" label="Provision device">
        <ng-template matStepContent>
          <app-provisioning></app-provisioning>
        </ng-template>
      </mat-step>
      <mat-step [editable]="false" label="Register device">
        <ng-template matStepContent>
          <h3>Your device is being registered; please wait...<br>
            <mat-progress-spinner *ngIf="isBusy" mode="indeterminate" diameter="16"></mat-progress-spinner>
          </h3>
        </ng-template>
      </mat-step>
      <mat-step [editable]="false" label="Done">
        <ng-template matStepContent>
          <h3>Your device has successfully been registered.</h3>
          <app-device-control></app-device-control>
          <app-device-diagnostics></app-device-diagnostics>
        </ng-template>
      </mat-step>
    </mat-stepper>

</ng-container>

<ng-template #communicating>

  <ng-container *ngIf="hasFatalError; else waitMessage">
    <h3 class="error-message">An error occurred: please reset your device</h3>
    <button mat-raised-button color="primary" type="button" (click)="reset()">Reset</button>
  </ng-container>

  <ng-template #waitMessage>
    <h3 class="wait-message">Communicating; please wait...</h3>
  </ng-template>

</ng-template>


